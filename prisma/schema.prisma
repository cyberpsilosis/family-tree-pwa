// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                    String   @id @default(cuid())
  firstName             String
  lastName              String
  birthYear             Int      // last two digits (99 = 1999)
  password              String   // hashed with bcrypt
  email                 String   @unique
  phone                 String?
  birthday              DateTime
  preferredContactMethod String? // "phone", "email", "text"
  instagram             String?
  facebook              String?
  twitter               String?
  linkedin              String?
  profilePhotoUrl       String?
  address               String?
  theme                 String   @default("light") // "light" or "dark"
  isAdmin               Boolean  @default(false)
  favoriteTeam          String?  // "49ers", "Raiders", "Other"
  customCardText        String?  // Custom text to display on card front
  isDeceased            Boolean  @default(false)  // Whether member is deceased
  
  // Family tree relationships
  parentId              String?
  parent                User?    @relation("FamilyTree", fields: [parentId], references: [id], onDelete: SetNull)
  children              User[]   @relation("FamilyTree")
  
  parent2Id             String?
  parent2               User?    @relation("FamilyTree2", fields: [parent2Id], references: [id], onDelete: SetNull)
  childrenAsParent2     User[]   @relation("FamilyTree2")
  
  // Legacy single friendship (kept for backward compatibility)
  friendId              String?
  friend                User?    @relation("Friendship", fields: [friendId], references: [id], onDelete: SetNull)
  friendOf              User[]   @relation("Friendship")
  relationshipType      String?  // "friend", "partner", "married"
  
  // New many-to-many relationships
  relationshipsFrom     UserRelationship[] @relation("RelationshipFrom")
  relationshipsTo       UserRelationship[] @relation("RelationshipTo")
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

// Junction table for many-to-many friend/partner relationships
model UserRelationship {
  id               String   @id @default(cuid())
  userId           String   // Person who added the relationship
  user             User     @relation("RelationshipFrom", fields: [userId], references: [id], onDelete: Cascade)
  relatedUserId    String   // Person they're connected to
  relatedUser      User     @relation("RelationshipTo", fields: [relatedUserId], references: [id], onDelete: Cascade)
  relationshipType String   // "friend", "partner", "married"
  isPrimary        Boolean  @default(false) // First person to add this connection determines placement
  createdAt        DateTime @default(now())
  
  @@unique([userId, relatedUserId, relationshipType])
  @@index([relatedUserId])
  @@index([userId])
}

model Admin {
  id        String   @id @default(cuid())
  password  String   // hashed admin password
  email     String   @unique
  createdAt DateTime @default(now())
}

model Donation {
  id            String   @id @default(cuid())
  amount        Float    // donation amount in dollars
  donorName     String?  // optional donor name
  donorEmail    String?  // optional donor email
  stripePaymentId String @unique // Stripe payment intent ID
  status        String   @default("succeeded") // "succeeded", "pending", "failed"
  createdAt     DateTime @default(now())
}

model DevelopmentCost {
  id               String   @id @default(cuid())
  currentAmount    Float    @default(0) // current amount paid
  goalAmount       Float    @default(5000) // target goal amount
  description      String?  // optional note about the payment
  updatedBy        String?  // admin who made the update
  updatedAt        DateTime @updatedAt
  createdAt        DateTime @default(now())
}

model DevelopmentCostItem {
  id          String   @id @default(cuid())
  description String   // what the cost is for (e.g., "Phase 1 development", "Database setup")
  amount      Float    // cost amount
  addedBy     String?  // admin who added it
  createdAt   DateTime @default(now())
}
